<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cut-Off – Painel Executivo</title>

<style>
  :root {
    --bg:#0b1020;
    --card:#121a33;
    --muted:#9aa4c0;
    --text:#e9ecf5;
    --line:#243055;
    --good:#22c55e;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg),#070a14);
    color:var(--text)
  }
  .wrap{max-width:1200px;margin:0 auto;padding:24px}
  h1{margin:0;font-size:22px}
  .sub{color:var(--muted);font-size:12px;margin-top:6px}

  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:16px}

  .card{
    background:rgba(18,26,51,.92);
    border:1px solid rgba(36,48,85,.8);
    border-radius:14px;
    padding:14px;
    box-shadow:0 10px 24px rgba(0,0,0,.25)
  }

  .kpi-title{color:var(--muted);font-size:12px}
  .kpi-value{font-size:22px;margin-top:8px;font-weight:700}

  /* Mais espaço para "Região" */
  .row{
    display:grid;
    grid-template-columns:1fr 1.4fr;
    gap:12px;
    margin-top:12px
  }

  @media (max-width:980px){
    .grid{grid-template-columns:repeat(2,1fr)}
    .row{grid-template-columns:1fr}
  }

  .section-title{margin:0 0 8px 0;font-size:14px;color:#d8ddf0}
  table{width:100%;border-collapse:collapse}
  th,td{
    padding:8px;
    border-bottom:1px solid rgba(36,48,85,.8);
    font-size:12px
  }
  th{color:#cfd6f3;text-align:left}

  .bar{
    height:8px;
    background:#0f1730;
    border-radius:999px;
    overflow:hidden
  }
  .bar span{
    display:block;
    height:100%;
    background:linear-gradient(90deg,#60a5fa,var(--good))
  }
  .mini{font-size:11px;color:var(--muted);line-height:1.35}
</style>
</head>

<body>
<div class="wrap">

<h1>Cut-Off – Painel Executivo</h1>
<div class="sub">Última atualização: <span id="updatedAt">—</span></div>

<!-- KPIs -->
<div class="grid" id="kpis"></div>

<div class="row">

  <!-- HISTÓRICO -->
  <div class="card">
    <div class="section-title">Resumo histórico – (anos anteriores)</div>
    <div id="yearChart"></div>
  </div>

  <!-- REGIÕES -->
  <div class="card">
    <div class="section-title">Janeiro – entregas por região</div>

    <div style="overflow:auto">
      <table id="regioesTable">
        <thead>
          <tr>
            <th>Região</th>
            <th>Faturado</th>
            <th>Entregue</th>
            <th>%</th>
            <th>Pendente</th>
            <th>Prev. Dez</th>
            <th>Prev. Jan</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

</div>

<!-- TABELA UF -->
<div class="card" style="margin-top:12px">
  <div class="section-title">Detalhamento por UF</div>
  <div style="overflow:auto;max-height:520px">
    <table id="ufTable">
      <thead>
        <tr>
          <th>UF</th>
          <th>Valor faturado</th>
          <th>Valor entregue</th>
          <th>% entregue</th>
          <th>Pendente</th>
          <th>Previsto Dez</th>
          <th>Previsto Jan</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

</div>

<script>
const brl=v=>Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
const pct=(a,b)=>b?((a/b)*100).toFixed(2).replace('.',',')+'%':'0,00%';

async function load(){
  const r=await fetch('./data.json?v='+Date.now(),{cache:'no-store'});
  const d=await r.json();

  document.getElementById('updatedAt').textContent=d.updated_at;

  /* KPIs */
  document.getElementById('kpis').innerHTML=[
    ['Valor faturado (Dez)',d.kpis.valor_faturado_dez],
    ['Valor entregue (Dez)',d.kpis.valor_entregue_dez],
    ['Entrega prevista – Dez',d.kpis.entrega_prevista_dez],
    ['Entrega prevista – Jan',d.kpis.entrega_prevista_jan]
  ].map(k=>`
    <div class="card">
      <div class="kpi-title">${k[0]}</div>
      <div class="kpi-value">${brl(k[1])}</div>
    </div>
  `).join('');

  /* Histórico (com resumo por ano restaurado) */
  document.getElementById('yearChart').innerHTML=d.historico_dezembro.map(a=>{
    const entregue=Number(a.entregue||0);
    const nao=Number(a.nao_entregue||0);
    const total=entregue+nao;
    const w= total ? (entregue/total)*100 : 0;

    return `
      <div style="margin-bottom:10px">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
          <div style="min-width:62px;font-weight:700">${a.ano}</div>
          <div style="flex:1">
            <div class="bar"><span style="width:$
