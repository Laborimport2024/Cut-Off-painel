<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cut-Off ‚Äì Painel Executivo</title>

<style>
  :root {
    --bg:#0b1020;
    --card:#121a33;
    --muted:#9aa4c0;
    --text:#e9ecf5;
    --line:#243055;
    --good:#22c55e;

    /* Novos tons executivos */
    --ink:#0b1b3a;         /* azul escuro p/ texto em cards claros */
    --whiteCard:#ffffff;   /* fundo KPI */
    --regionCard:#0f2a53;  /* destaque regi√µes */
    --regionLine:rgba(255,255,255,.10);

    /* Cabe√ßalhos (um pouco mais escuros que antes, sem superar os valores) */
    --table-head-mid:#8f9ac2;

    /* Vermelho executivo que conversa com o azul */
    --alert-red:#c0362c;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg),#070a14);
    color:var(--text)
  }
  .wrap{max-width:1200px;margin:0 auto;padding:24px}

  h1{margin:0;font-size:22px}
  .sub{color:var(--muted);font-size:12px;margin-top:6px}

  /* =========================
     HEADER (T√çTULO + OBJETIVO)
     ========================= */
  .header{
    display:flex;
    align-items:baseline;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
  }
  .objective{
    font-size:12px;
    color:var(--muted);
    white-space:nowrap;
  }
  .objective b{
    color:#d8ddf0;
    font-weight:700;
  }

  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:16px}

  .card{
    background:rgba(18,26,51,.92);
    border:1px solid rgba(36,48,85,.8);
    border-radius:14px;
    padding:14px;
    box-shadow:0 10px 24px rgba(0,0,0,.25)
  }

  /* KPI destacado (fundo branco) */
  .card.kpi{
    background:var(--whiteCard);
    border:1px solid rgba(255,255,255,.35);
    box-shadow:0 14px 30px rgba(0,0,0,.28);
  }
  .card.kpi .kpi-title{color:rgba(11,27,58,.65)}
  .card.kpi .kpi-value{color:var(--ink)}

  /* üî¥ KPI 4 (Entrega prevista ‚Äì Jan) em vermelho */
  #kpis .card.kpi:nth-child(4) .kpi-title,
  #kpis .card.kpi:nth-child(4) .kpi-value{
    color:var(--alert-red);
  }

  /* Card destaque por regi√£o */
  .card.region{
    background:linear-gradient(180deg, rgba(21,60,120,.45), rgba(15,42,83,.92));
    border:1px solid var(--regionLine);
  }
  .card.region .section-title{color:#eaf0ff}
  .card.region table th,
  .card.region table td{
    border-bottom:1px solid var(--regionLine);
  }

  .kpi-title{color:var(--muted);font-size:12px}
  .kpi-value{font-size:22px;margin-top:8px;font-weight:800; letter-spacing:.2px}

  .row{
    display:grid;
    grid-template-columns:1fr 1.4fr;
    gap:12px;
    margin-top:12px
  }

  @media (max-width:980px){
    .grid{grid-template-columns:repeat(2,1fr)}
    .row{grid-template-columns:1fr}
  }

  .section-title{margin:0 0 8px 0;font-size:14px;color:#d8ddf0}

  table{width:100%;border-collapse:collapse}
  th,td{
    padding:8px;
    border-bottom:1px solid rgba(36,48,85,.8);
    font-size:12px
  }
  th{color:#cfd6f3;text-align:left}

  .bar{
    height:8px;
    background:#0f1730;
    border-radius:999px;
    overflow:hidden
  }
  .bar span{
    display:block;
    height:100%;
    background:linear-gradient(90deg,#60a5fa,var(--good))
  }

  .toolbar{
    display:flex;
    gap:10px;
    margin-bottom:8px;
    flex-wrap:wrap;
    align-items:center
  }

  .toolbar input,
  .toolbar select,
  .toolbar button{
    background:#0f1730;
    border:1px solid var(--line);
    color:var(--text);
    padding:8px 10px;
    border-radius:8px;
    font-size:12px;
  }

  .toolbar input{width:200px}
  .toolbar select{min-width:220px}
  .toolbar button{
    cursor:pointer;
    user-select:none;
  }
  .toolbar button:hover{filter:brightness(1.08)}

  .mini{font-size:11px;color:var(--muted);line-height:1.35}

  /* üîó Link final */
  .footer-link{
    margin-top:16px;
    padding:12px 14px;
    border:1px dashed var(--line);
    border-radius:12px;
    font-size:12px;
    color:var(--muted)
  }
  .footer-link a{
    color:#93c5fd;
    text-decoration:none;
    word-break:break-all
  }
  .footer-link a:hover{ text-decoration:underline }

  /* =========================
     AJUSTES DE CABE√áALHO (UF)
     ========================= */

  /* Cabe√ßalhos num√©ricos ‚Äì mais escuros, mas abaixo dos valores */
  #ufTable thead th:nth-child(2),
  #ufTable thead th:nth-child(3),
  #ufTable thead th:nth-child(5),
  #ufTable thead th:nth-child(6){
    color:var(--table-head-mid);
    font-weight:600;
  }

  /* üî¥ Coluna Previsto Jan (UF): t√≠tulo + valores em vermelho */
  #ufTable thead th:nth-child(7),
  #ufTable tbody td:nth-child(7){
    color:var(--alert-red);
    font-weight:600;
  }
</style>
</head>

<body>
<div class="wrap">

  <div class="header">
    <h1>Cut-Off ‚Äì Painel Executivo</h1>
    <div class="objective">Objetivo: <b>R$ 8.960.000,00</b></div>
  </div>

  <div class="sub">√öltima atualiza√ß√£o: <span id="updatedAt">‚Äî</span></div>

  <!-- KPIs -->
  <div class="grid" id="kpis"></div>

  <div class="row">

    <!-- HIST√ìRICO -->
    <div class="card">
      <div class="section-title">Resumo hist√≥rico ‚Äì (anos anteriores)</div>
      <div id="yearChart"></div>
    </div>

    <!-- REGI√ïES -->
    <div class="card region">
      <div class="section-title">Entregas por Regi√£o</div>
      <div style="overflow:auto">
        <table id="regioesTable">
          <thead>
            <tr>
              <th>Regi√£o</th>
              <th>Faturado</th>
              <th>Entregue</th>
              <th>%</th>
              <th>Pendente</th>
              <th>Prev. Dez</th>
              <th>Prev. Jan</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </div>

  <!-- DETALHAMENTO POR UF -->
  <div class="card" style="margin-top:12px">
    <div class="section-title">Detalhamento por UF</div>

    <div class="toolbar">
      <input id="ufSearch" placeholder="Pesquisar UF (ex: SP)" />

      <!-- Ordena√ß√£o -->
      <select id="ufSort">
        <option value="ValorFaturado">Ordenar por: Valor faturado</option>
        <option value="ValorEntregue">Ordenar por: Valor entregue</option>
        <option value="Pendente">Ordenar por: Pendente</option>
        <option value="PrevDez">Ordenar por: Previsto Dez</option>
        <option value="PrevJan">Ordenar por: Previsto Jan</option>
      </select>

      <button id="ufDir" type="button" aria-label="Alternar dire√ß√£o">
        Descendente
      </button>
    </div>

    <div style="overflow:auto;max-height:520px">
      <table id="ufTable">
        <thead>
          <tr>
            <th>UF</th>
            <th>Valor faturado</th>
            <th>Valor entregue</th>
            <th>% entregue</th>
            <th>Pendente</th>
            <th>Previsto Dez</th>
            <th>Previsto Jan</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- üîó LINK FINAL -->
  <div class="footer-link">
    Para mais detalhes acessar o link:
    <br/>
    <a href="https://bunzlbr-my.sharepoint.com/:x:/r/personal/fernando_milani_laborhs_com_br/Documents/Cut-off%202025/CUT%20OFF%202025.xlsx?d=w7a08996d21e646f6ad8d3d14996f3dea&csf=1&web=1&e=9L7Gx4"
       target="_blank" rel="noopener noreferrer">
      https://bunzlbr-my.sharepoint.com/:x:/r/personal/fernando_milani_laborhs_com_br/Documents/Cut-off%202025/CUT%20OFF%202025.xlsx
    </a>
  </div>

</div>

<script>
const brl=v=>Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
const pct=(a,b)=>b?((a/b)*100).toFixed(2).replace('.',',')+'%':'0,00%';

let ufData=[];
let ufView=[];
let sortKey='ValorFaturado';
let sortDir='desc';

function applyUFView(){
  const term=(document.getElementById('ufSearch').value||'').toUpperCase().trim();
  const filtered = term ? ufData.filter(u => String(u.UF||'').toUpperCase().includes(term)) : [...ufData];

  filtered.sort((x,y)=>{
    const ax=Number(x?.[sortKey]||0);
    const ay=Number(y?.[sortKey]||0);
    return sortDir==='asc' ? (ax - ay) : (ay - ax);
  });

  ufView=filtered;
  renderUFTable(ufView);
}

async function load(){
  const r=await fetch('./data.json?v='+Date.now(),{cache:'no-store'});
  const d=await r.json();

  document.getElementById('updatedAt').textContent=d.updated_at;

  document.getElementById('kpis').innerHTML=[
    ['Valor faturado (Dez)',d.kpis.valor_faturado_dez],
    ['Valor entregue (Dez)',d.kpis.valor_entregue_dez],
    ['Entrega prevista ‚Äì Dez',d.kpis.entrega_prevista_dez],
    ['Entrega prevista ‚Äì Jan',d.kpis.entrega_prevista_jan]
  ].map(k=>`
    <div class="card kpi">
      <div class="kpi-title">${k[0]}</div>
      <div class="kpi-value">${brl(k[1])}</div>
    </div>
  `).join('');

  document.getElementById('yearChart').innerHTML=d.historico_dezembro.map(a=>{
    const total=a.entregue+a.nao_entregue;
    const w= total ? (a.entregue/total)*100 : 0;
    return `
      <div style="margin-bottom:10px">
        <b>${a.ano}</b>
        <div class="bar"><span style="width:${w}%"></span></div>
        <div class="mini">
          Entregue ${brl(a.entregue)} ‚Ä¢ N√£o entregue ${brl(a.nao_entregue)} ‚Ä¢ Total ${brl(total)}
        </div>
      </div>
    `;
  }).join('');

  document.querySelector('#regioesTable tbody').innerHTML=
    d.regioes.map(r=>{
      const p=r.valor_faturado ? r.valor_entregue/r.valor_faturado : 0;
      return `
        <tr>
          <td><b>${r.regiao}</b></td>
          <td>${brl(r.valor_faturado)}</td>
          <td>${brl(r.valor_entregue)}</td>
          <td>
            ${pct(r.valor_entregue,r.valor_faturado)}
            <div class="bar"><span style="width:${p*100}%"></span></div>
          </td>
          <td>${brl(r.valor_pendente)}</td>
          <td>${brl(r.previsto_dez)}</td>
          <td>${brl(r.previsto_jan)}</td>
        </tr>
      `;
    }).join('');

  ufData=d.uf || [];
  applyUFView();
}

function renderUFTable(data){
  document.querySelector('#ufTable tbody').innerHTML=
    data.map(u=>`
      <tr>
        <td><b>${u.UF}</b></td>
        <td>${brl(u.ValorFaturado)}</td>
        <td>${brl(u.ValorEntregue)}</td>
        <td>${pct(u.ValorEntregue,u.ValorFaturado)}</td>
        <td>${brl(u.Pendente)}</td>
        <td>${brl(u.PrevDez)}</td>
        <td>${brl(u.PrevJan)}</td>
      </tr>
    `).join('');
}

document.addEventListener('input',e=>{
  if(e.target.id==='ufSearch'){
    applyUFView();
  }
});

document.addEventListener('change',e=>{
  if(e.target.id==='ufSort'){
    sortKey=e.target.value;
    applyUFView();
  }
});

document.getElementById('ufDir').addEventListener('click',()=>{
  sortDir = (sortDir==='desc') ? 'asc' : 'desc';
  document.getElementById('ufDir').textContent = sortDir==='desc' ? 'Descendente' : 'Ascendente';
  applyUFView();
});

load();
</script>
</body>
</html>
