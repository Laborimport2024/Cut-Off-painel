<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cut-Off â€“ Painel Executivo</title>

<style>
  :root {
    --bg:#0b1020;
    --card:#121a33;
    --muted:#9aa4c0;
    --text:#e9ecf5;
    --line:#243055;
    --good:#22c55e;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg),#070a14);
    color:var(--text)
  }
  .wrap{max-width:1200px;margin:0 auto;padding:24px}
  h1{margin:0;font-size:22px}
  .sub{color:var(--muted);font-size:12px;margin-top:6px}

  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:16px}

  .card{
    background:rgba(18,26,51,.92);
    border:1px solid rgba(36,48,85,.8);
    border-radius:14px;
    padding:14px;
    box-shadow:0 10px 24px rgba(0,0,0,.25)
  }

  .kpi-title{color:var(--muted);font-size:12px}
  .kpi-value{font-size:22px;margin-top:8px;font-weight:700}

  .row{
    display:grid;
    grid-template-columns:1fr 1.4fr;
    gap:12px;
    margin-top:12px
  }

  @media (max-width:980px){
    .grid{grid-template-columns:repeat(2,1fr)}
    .row{grid-template-columns:1fr}
  }

  .section-title{margin:0 0 8px 0;font-size:14px;color:#d8ddf0}

  table{width:100%;border-collapse:collapse}
  th,td{
    padding:8px;
    border-bottom:1px solid rgba(36,48,85,.8);
    font-size:12px
  }
  th{color:#cfd6f3;text-align:left}

  .bar{
    height:8px;
    background:#0f1730;
    border-radius:999px;
    overflow:hidden
  }
  .bar span{
    display:block;
    height:100%;
    background:linear-gradient(90deg,#60a5fa,var(--good))
  }

  .toolbar{
    display:flex;
    gap:10px;
    margin-bottom:8px
  }

  .toolbar input{
    background:#0f1730;
    border:1px solid var(--line);
    color:var(--text);
    padding:8px 10px;
    border-radius:8px;
    font-size:12px;
    width:200px
  }

  .mini{font-size:11px;color:var(--muted);line-height:1.35}
</style>
</head>

<body>
<div class="wrap">

<h1>Cut-Off â€“ Painel Executivo</h1>
<div class="sub">Ãšltima atualizaÃ§Ã£o: <span id="updatedAt">â€”</span></div>

<!-- KPIs -->
<div class="grid" id="kpis"></div>

<div class="row">

  <!-- HISTÃ“RICO -->
  <div class="card">
    <div class="section-title">Resumo histÃ³rico â€“ (anos anteriores)</div>
    <div id="yearChart"></div>
  </div>

  <!-- REGIÃ•ES -->
  <div class="card">
    <div class="section-title">Janeiro â€“ entregas por regiÃ£o</div>
    <div style="overflow:auto">
      <table id="regioesTable">
        <thead>
          <tr>
            <th>RegiÃ£o</th>
            <th>Faturado</th>
            <th>Entregue</th>
            <th>%</th>
            <th>Pendente</th>
            <th>Prev. Dez</th>
            <th>Prev. Jan</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<!-- DETALHAMENTO POR UF -->
<div class="card" style="margin-top:12px">
  <div class="section-title">Detalhamento por UF</div>

  <!-- ðŸ” PESQUISA POR UF -->
  <div class="toolbar">
    <input id="ufSearch" placeholder="Pesquisar UF (ex: SP)" />
  </div>

  <div style="overflow:auto;max-height:520px">
    <table id="ufTable">
      <thead>
        <tr>
          <th>UF</th>
          <th>Valor faturado</th>
          <th>Valor entregue</th>
          <th>% entregue</th>
          <th>Pendente</th>
          <th>Previsto Dez</th>
          <th>Previsto Jan</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

</div>

<script>
const brl=v=>Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
const pct=(a,b)=>b?((a/b)*100).toFixed(2).replace('.',',')+'%':'0,00%';

let ufData=[];

async function load(){
  const r=await fetch('./data.json?v='+Date.now(),{cache:'no-store'});
  const d=await r.json();

  document.getElementById('updatedAt').textContent=d.updated_at;

  /* KPIs */
  document.getElementById('kpis').innerHTML=[
    ['Valor faturado (Dez)',d.kpis.valor_faturado_dez],
    ['Valor entregue (Dez)',d.kpis.valor_entregue_dez],
    ['Entrega prevista â€“ Dez',d.kpis.entrega_prevista_dez],
    ['Entrega prevista â€“ Jan',d.kpis.entrega_prevista_jan]
  ].map(k=>`
    <div class="card">
      <div class="kpi-title">${k[0]}</div>
      <div class="kpi-value">${brl(k[1])}</div>
    </div>
  `).join('');

  /* HistÃ³rico */
  document.getElementById('yearChart').innerHTML=d.historico_dezembro.map(a=>{
    const total=a.entregue+a.nao_entregue;
    const w= total ? (a.entregue/total)*100 : 0;
    return `
      <div style="margin-bottom:10px">
        <b>${a.ano}</b>
        <div class="bar"><span style="width:${w}%"></span></div>
        <div class="mini">
          Entregue ${brl(a.entregue)} â€¢ NÃ£o entregue ${brl(a.nao_entregue)} â€¢ Total ${brl(total)}
        </div>
      </div>
    `;
  }).join('');

  /* RegiÃµes */
  document.querySelector('#regioesTable tbody').innerHTML=
    d.regioes.map(r=>{
      const p=r.valor_faturado ? r.valor_entregue/r.valor_faturado : 0;
      return `
        <tr>
          <td><b>${r.regiao}</b></td>
          <td>${brl(r.valor_faturado)}</td>
          <td>${brl(r.valor_entregue)}</td>
          <td>
            ${pct(r.valor_entregue,r.valor_faturado)}
            <div class="bar"><span style="width:${p*100}%"></span></div>
          </td>
          <td>${brl(r.valor_pendente)}</td>
          <td>${brl(r.previsto_dez)}</td>
          <td>${brl(r.previsto_jan)}</td>
        </tr>
      `;
    }).join('');

  /* UF */
  ufData = d.uf;
  renderUFTable(ufData);
}

function renderUFTable(data){
  document.querySelector('#ufTable tbody').innerHTML=
    data.map(u=>`
      <tr>
        <td><b>${u.UF}</b></td>
        <td>${brl(u.ValorFaturado)}</td>
        <td>${brl(u.ValorEntregue)}</td>
        <td>${pct(u.ValorEntregue,u.ValorFaturado)}</td>
        <td>${brl(u.Pendente)}</td>
        <td>${brl(u.PrevDez)}</td>
        <td>${brl(u.PrevJan)}</td>
      </tr>
    `).join('');
}

/* ðŸ” FILTRO POR UF */
document.addEventListener('input',e=>{
  if(e.target.id==='ufSearch'){
    const term=e.target.value.toUpperCase();
    renderUFTable(
      ufData.filter(u=>u.UF.includes(term))
    );
  }
});

load();
</script>
</body>
</html>
